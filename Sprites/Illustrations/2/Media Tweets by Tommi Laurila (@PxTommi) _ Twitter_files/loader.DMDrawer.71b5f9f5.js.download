(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{"3GUV":function(e,t,a){"use strict";var r=a("ERkP"),n=a("rHpw"),s=a("MWbm");class i extends r.Component{shouldComponentUpdate(){return!1}render(){return r.createElement(s.a,{style:o.root})}}const o=n.a.create(e=>({root:{height:5*parseInt(e.lineHeight,10)+"rem"}}));t.a=i},"4q8G":function(e,t,a){"use strict";var r=a("t0aI");t.a=({sort_event_id:e},{sort_event_id:t})=>e?t?Object(r.a)(t,e):1:-1},"5UID":function(e,t,a){"use strict";var r=a("ERkP"),n=a("3XMw"),s=a.n(n),i=a("rHpw"),o=(a("aWzz"),a("+/1j")),l=a("MWbm");const c=s.a.e5b0063d;let d=0;class h extends r.Component{constructor(){super(),this._listDomId="accessible-list-"+d,d+=1}render(){const{children:e,title:t}=this.props,a=c({title:t});return r.createElement(l.a,{accessibilityRole:"region","aria-labelledby":this._listDomId},r.createElement(o.a,{accessibilityRole:"heading","aria-level":1,nativeID:this._listDomId,style:i.a.visuallyHidden},t),r.createElement(l.a,{accessibilityLabel:a},e))}}t.a=h},Avzu:function(e,t,a){"use strict";a("IAdD");var r=a("ERkP"),n=a("Lsrn"),s=a("k/Ka");const i=(e={})=>Object(s.a)("svg",Object.assign({},e,{style:[n.a.root,e.style],viewBox:"0 0 24 24"}),r.createElement("g",null,r.createElement("path",{d:"M23.25 3.25h-2.425V.825c0-.414-.336-.75-.75-.75s-.75.336-.75.75V3.25H16.9c-.414 0-.75.336-.75.75s.336.75.75.75h2.425v2.425c0 .414.336.75.75.75s.75-.336.75-.75V4.75h2.425c.414 0 .75-.336.75-.75s-.336-.75-.75-.75zm-3.175 6.876c-.414 0-.75.336-.75.75v8.078c0 .414-.337.75-.75.75H4.095c-.412 0-.75-.336-.75-.75V8.298l6.778 4.518c.368.246.79.37 1.213.37.422 0 .844-.124 1.212-.37l4.53-3.013c.336-.223.428-.676.204-1.012-.223-.332-.675-.425-1.012-.2l-4.53 3.014c-.246.162-.563.163-.808 0l-7.586-5.06V5.5c0-.414.337-.75.75-.75h9.094c.414 0 .75-.336.75-.75s-.336-.75-.75-.75H4.096c-1.24 0-2.25 1.01-2.25 2.25v13.455c0 1.24 1.01 2.25 2.25 2.25h14.48c1.24 0 2.25-1.01 2.25-2.25v-8.078c0-.415-.337-.75-.75-.75z"})));i.metadata={width:24,height:24},t.a=i},BUB3:function(e,t,a){"use strict";a("IAdD");var r=a("LdEA"),n=a.n(r),s=a("ERkP"),i=a("sNn6"),o=a("rHpw"),l=a("MWbm");const c=o.a.create(e=>({activeRoot:{backgroundColor:e.colors.faintGray},overlay:Object.assign({},o.a.absoluteFillObject,{borderRightStyle:"solid",borderRightWidth:e.borderWidths.medium,borderRightColor:e.colors.primary,zIndex:1})}));t.a=e=>{let{children:t}=e,a=n()(e,["children"]);return s.createElement(i.a,a,e=>s.createElement(l.a,{style:[e&&c.activeRoot]},"function"==typeof t?t(e):t,e?s.createElement(l.a,{pointerEvents:"none",style:c.overlay}):null))}},TEoO:function(e,t,a){"use strict";var r=a("LdEA"),n=a.n(r),s=a("ERkP"),i=a("5UID"),o=a("3GUV"),l=a("iBK2");const c=s.createElement(o.a,null),d=e=>{let{accessibilityTitle:t}=e,a=n()(e,["accessibilityTitle"]);const r=s.createElement(l.b,a);return t?s.createElement(i.a,{title:t},r):r};d.defaultProps={footer:c},t.a=d},fuhe:function(e,t,a){"use strict";a.r(t),a.d(t,"DMDrawer",(function(){return ze}));a("3voH"),a("kYxP");var r=a("97Jx"),n=a.n(r),s=a("KEM+"),i=a.n(s),o=a("ERkP"),l=a("ZUOq"),c=a("MMRb"),d=a("rxPX"),h=a("0KEI"),m=a("RqPI");var p=Object(d.a)().propsFromState(()=>({conversations:c.selectConversations,drawerExperimentEnabled:c.selectDrawerExperimentEnabled,perspective:m.g,poppedOutConversationId:c.selectPoppedOutConversationId,visibility:c.selectDrawerVisibility})).propsFromActions(()=>({createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_CONVERSATION"),fetchInboxIfNeeded:c.fetchInboxIfNeeded,loadDrawerExperimentFromPersistence:c.loadDrawerExperimentFromPersistence,loadDrawerVisibilityFromPersistence:c.loadDrawerVisibilityFromPersistence,setDrawerVisibility:c.setDrawerVisibility})),u=(a("IAdD"),a("VnFT")),g=a("1YZw"),b=a("hqKg"),E=a("Myq3"),_=a("AQOc"),v=a("UhuB"),f=a("l0YN"),y=a("G6rE"),I=a("P1r1");const C=(e,t)=>t.conversationId,x=Object(b.createSelector)((e,t)=>c.selectEntriesForConversation(e,C(0,t)),m.g,(e,t)=>t?((e,t)=>{const a=Object(E.a)(e,e=>!!e.message_data&&(e.message_data&&e.message_data.recipient_id===t));return a&&a.message_data&&a.message_data.quick_reply&&a.message_data.quick_reply&&"options"===a.message_data.quick_reply.type?a.message_data.quick_reply:void 0})(e,t):void 0),w=e=>t=>u.c(e,t),S=e=>(t,a)=>u.a(e,t,a),O={conversation:(e,t)=>c.selectConversation(e,C(0,t)),entries:c.selectEntries,perspective:m.g,users:y.e.selectAll,dataSaverMode:I.j,dtabBarInfo:I.l,quickReplyOptions:x,visibility:c.selectDrawerVisibility,inboxUnreadCount:f.a,isUnread:(e,t)=>!c.selectConversationIsRead(e,C(0,t)),isDmReceiptSettingEnabled:v.j},D={draftText:(e,t)=>u.m(e,C(0,t)),gifMetadata:(e,t)=>u.h(e,C(0,t)),isUploading:(e,t)=>u.j(e,C(0,t)),media:(e,t)=>u.i(e,C(0,t)),mediaMetadata:(e,t)=>u.k(e,C(0,t)),mediaUploadProgress:(e,t)=>u.l(e,C(0,t))};var M=Object(d.a)().propsFromState(()=>Object.assign({},O,D)).adjustStateProps(({conversation:e,entries:t,perspective:a,users:r,dataSaverMode:n,draftText:s,dtabBarInfo:i,gifMetadata:o,inboxUnreadCount:l,isDmReceiptSettingEnabled:c,isUploading:d,isUnread:h,media:m,mediaMetadata:p,mediaUploadProgress:u,quickReplyOptions:g,visibility:b})=>{const E=null==e?void 0:e.data;return{conversation:E&&Object(_.a)(E,t,r),perspective:a,dataSaverMode:n,draftText:s,dtabBarInfo:i,gifMetadata:o,inboxUnreadCount:l,isDmReceiptSettingEnabled:c,isUploading:d,isUnread:h,media:m,mediaMetadata:p,mediaUploadProgress:u,quickReplyOptions:g,visibility:b}}).propsFromActions(({conversationId:e})=>({addMedia:S(e),addToast:g.b,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationHistory:c.fetchConversationHistory,removeMedia:w(e),saveText:u.f,sendMessage:u.n,updateConversationReadState:c.updateConversationReadState,updateTyping:c.updateTyping,fetchUpdatesIfNeeded:c.fetchUpdatesIfNeeded})).withAnalytics({page:"messages",section:"thread_drawer"}),N=a("aWyx"),H=a("qz2E"),T=(a("uB9N"),a("Oi4X")),P=a("OhSZ"),A=a("zh9S"),R=Object(d.a)().propsFromState(()=>({visibility:c.selectDrawerVisibility})).propsFromActions(()=>({scribeAction:A.c,popOutConversation:c.popOutConversation,setDrawerVisibility:c.setDrawerVisibility})),k=a("xPna"),F=a("wrlS"),j=a("3XMw"),L=a.n(j),U=a("OrGc"),B=a("hACr"),V=a("MWbm"),W=a("/yvb"),G=a("Znyr"),$=a("t62R"),q=a("xKuM"),z=a("rHpw"),K=a("95Se"),Q=a("Avzu"),X=a("Lsrn"),Y=a("k/Ka");const J=(e={})=>Object(Y.a)("svg",Object.assign({},e,{style:[X.a.root,e.style],viewBox:"0 0 24 24"}),o.createElement("g",null,o.createElement("path",{d:"M12 19.344l-8.72-8.72c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l9.25 9.25c.292.294.767.294 1.06 0l9.25-9.25c.146-.145.22-.337.22-.53s-.073-.383-.22-.53c-.293-.292-.768-.292-1.06 0L12 19.344z"}),o.createElement("path",{d:"M12 11.535l-8.72-8.72c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l9.25 9.25c.292.294.767.294 1.06 0l9.25-9.25c.146-.145.22-.337.22-.53s-.073-.383-.22-.53c-.293-.292-.768-.292-1.06 0L12 11.535z"})));J.metadata={width:24,height:24};var Z=J;const ee=(e={})=>Object(Y.a)("svg",Object.assign({},e,{style:[X.a.root,e.style],viewBox:"0 0 24 24"}),o.createElement("g",null,o.createElement("path",{d:"M12 4.656l8.72 8.72c.293.293.768.293 1.06 0s.294-.768 0-1.06l-9.25-9.25c-.292-.294-.767-.294-1.06 0l-9.25 9.25c-.146.145-.22.337-.22.53s.073.383.22.53c.293.292.768.292 1.06 0L12 4.656z"}),o.createElement("path",{d:"M12 12.465l8.72 8.72c.293.293.768.293 1.06 0s.294-.768 0-1.06l-9.25-9.25c-.292-.294-.767-.294-1.06 0l-9.25 9.25c-.146.145-.22.337-.22.53s.073.383.22.53c.293.292.768.292 1.06 0l8.72-8.72z"})));ee.metadata={width:24,height:24};var te=ee,ae=a("hOZg"),re=a("x0mb");const ne=L.a.a2f8105f,se=L.a.e839db39,ie=L.a.d227d19e,oe=L.a.c64c1883,le=L.a.j7d0e835,ce=L.a.b08821f3,de=L.a.e736990a;class he extends o.Component{constructor(e){super(e),i()(this,"_headerBar",o.createRef()),i()(this,"_isExpanded",()=>{const{visibility:e}=this.props;return e===k.a.EXPANDED}),i()(this,"_renderLeftControl",()=>{const{inboxUnreadCount:e}=this.props;return o.createElement(V.a,null,o.createElement(W.a,{accessibilityLabel:ce,icon:o.createElement(K.a,null),onPress:this._handleUnpopConvo,type:"text"}),e&&e>0?o.createElement(G.a,{pip:!0,style:me.newMessagePip,truncatedCountFormatter:()=>"",unreadCountLabel:()=>""}):null)}),i()(this,"_renderRightControl",()=>{const{conversationTitle:e,isHighlighted:t,hasNewMessages:a}=this.props,r=this._isExpanded(),n=t&&a?"invertedText":"text";return o.createElement(V.a,{role:"complementary",style:me.rightControls},e?null:o.createElement(W.a,{accessibilityLabel:oe,icon:o.createElement(Q.a,null),onPress:this._handleNewMessage,type:n}),r?o.createElement(W.a,{accessibilityLabel:ie,icon:o.createElement(Z,null),onPress:this._handleToggleVisibility,type:n}):o.createElement(W.a,{accessibilityLabel:le,icon:o.createElement(te,null),onPress:this._handleToggleVisibility,type:n}),this._showDMQuickAccessWithClose?o.createElement(W.a,{accessibilityLabel:se,icon:o.createElement(ae.a,null),onPress:this._handleClose,type:n}):null)}),i()(this,"_handleUnpopConvo",()=>{const{popOutConversation:e}=this.props;e(null)}),i()(this,"_handleToggleVisibility",()=>{const{scribeAction:e,scribeNamespace:t,setDrawerVisibility:a,onDrawerOpen:r}=this.props,n=this._isExpanded()?k.a.COLLAPSED:k.a.EXPANDED;n===k.a.COLLAPSED?e(Object.assign({},t,{action:"collapse"})):n===k.a.EXPANDED&&(e(Object.assign({},t,{action:"expand"})),r&&r()),a(n)}),i()(this,"_handleToggleVisibilityKeyboard",()=>{this._handleToggleVisibility(),this._headerBar&&this._headerBar.current&&this._headerBar.current.focus()}),i()(this,"_handleClose",()=>{const{scribeAction:e,scribeNamespace:t,setDrawerVisibility:a}=this.props;e(Object.assign({},t,{action:"close"})),a(k.a.CLOSED)}),i()(this,"_handleNewMessage",()=>{const{history:e,scribeAction:t,scribeNamespace:a}=this.props;t(Object.assign({},a,{section:"compose_drawer",component:"dm",action:"show"})),e.push({pathname:"/messages/compose",state:{source:"drawer"}})}),i()(this,"_renderTitle",()=>{const{conversationTitle:e,hasNewMessages:t,isHighlighted:a}=this.props,r=e||o.createElement($.c,null,ne);return o.createElement(V.a,{style:me.titleContainer},o.createElement(V.a,{style:[me.titleTextRoot,a&&t?me.titleTextHighlighted:null]},r),t?o.createElement(V.a,{style:me.newMessageDotContainer},o.createElement(re.a,{accessibilityLabel:de,style:[me.newMessageDotRoot,a?me.newMessageDotHighlighted:me.newMessageDotRegular]})):null)}),this._showDMQuickAccessWithClose=F.a.isTrue("responsive_web_dm_quick_access_with_close_enabled")}componentDidUpdate(e){const{hasNewMessages:t,isHighlighted:a,triggerHighlight:r}=this.props;e.isHighlighted||a||e.hasNewMessages||!t||r&&r()}render(){const{conversationTitle:e,conversationSubtitle:t,hasNewMessages:a,isHighlighted:r}=this.props,n=a?r?[me.headerHighlighted]:[me.headerActive]:[],s=this._isExpanded();return o.createElement(B.a,{enabled:!0,handlers:{[U.d.toggleDMDrawer]:this._handleToggleVisibilityKeyboard}},o.createElement(V.a,{ref:this._headerBar,style:[me.headerRoot,!s&&me.headerBorderClosed,...n,me.cursor,{zIndex:1}]},o.createElement(q.a,{leftControl:e&&this._isExpanded()?this._renderLeftControl():null,onMiddleControlClick:this._handleToggleVisibility,rightControl:this._renderRightControl(),subtitle:t,title:this._renderTitle(),withBackground:!1})))}}const me=z.a.create(e=>({root:{alignSelf:"flex-end",backgroundColor:e.colors.navigationBackground,borderColor:e.colors.borderColor,borderWidth:e.borderWidths.small,marginRight:e.spaces.medium,width:l.a.columnWidths.secondary.normal},cursor:{cursor:"pointer"},expanded:{height:l.a.columnWidths.secondary.normal},headerRoot:{borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderColor:e.colors.borderColor,borderTopLeftRadius:e.borderRadii.large,borderTopRightRadius:e.borderRadii.large,transition:"all 0.3s ease"},headerBorderClosed:{borderColor:e.colors.navigationBackground},headerActive:{backgroundColor:e.colors.unreadCellBackground},headerHighlighted:{borderColor:e.colors.primary,backgroundColor:e.colors.primary},titleContainer:{alignItems:"center",display:"flex",flexDirection:"row",flexGrow:1},titleTextRoot:{flexGrow:1,flexShrink:1},titleTextHighlighted:{color:e.colors.white},newMessageDotContainer:{flexGrow:1},newMessageDotRoot:{width:e.spaces.xSmall,height:e.spaces.xSmall,marginLeft:e.spaces.xxSmall},newMessageDotRegular:{color:e.colors.primary},newMessageDotHighlighted:{color:e.colors.white},newMessagePip:{right:e.spaces.xxSmall,top:e.spaces.xxSmall},rightControls:{flexDirection:"row"}}));var pe=R(he),ue=a("aWzz"),ge=a("XnpN"),be=(a("JtPf"),a("zb92")),Ee=Object(be.a)({loader:()=>Promise.all([a.e(9),a.e(166)]).then(a.bind(null,"Z+oW")),renderPlaceholder:()=>null}),_e=a("GSsg"),ve=a("aITJ"),fe=a("yrzJ");class ye extends o.Component{constructor(e){super(e),i()(this,"_composer",o.createRef()),i()(this,"_renderConversation",(e,t)=>{const{conversationId:a,history:r,location:n}=this.props;return o.createElement(T.a,{conversationId:a,history:r,isWide:!1,location:n,richTextInputContext:e,typeaheadWrapper:t})}),i()(this,"_isExpanded",()=>{const{visibility:e}=this.props;return e===k.a.EXPANDED}),i()(this,"_fetchUpdatesIfNeeded",()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:a,isDmReceiptSettingEnabled:r}=this.props;a(r?{active_conversation_id:e,dm_users:!0}:{}).catch(t())}),Object(H.a)()}componentDidMount(){this._updatePolling()}componentDidUpdate(e){e.visibility!==this.props.visibility&&this._updatePolling()}render(){const{analytics:e,conversation:t,perspective:a,history:r,isUnread:n,inboxUnreadCount:s,isHeaderHighlighted:i,onDrawerOpen:l,triggerHeaderHighlight:c}=this.props,d=this._isExpanded(),h=i?"white":"normal",m=i?"white":"deepGray",p=t&&t.type===N.a.ONE_TO_ONE&&a&&Object(ge.a)(t,a).map(({user:e})=>e.screen_name),u=p?o.createElement(fe.a,{color:m,screenName:p[0]}):void 0;return o.createElement(V.a,{style:d&&Ie.expanded},o.createElement(pe,{conversationSubtitle:u,conversationTitle:o.createElement(P.b,{conversation:t,perspective:a,textColor:h,withScreenName:!1}),hasNewMessages:n,history:r,inboxUnreadCount:s,isHighlighted:i,onDrawerOpen:l,scribeNamespace:e.contextualScribeNamespace,triggerHighlight:c}),d?ve.a.isDesktopOS()?o.createElement(Ee,null,({richTextInputContext:e,typeaheadWrapper:t})=>this._renderConversation(e,t)):this._renderConversation():null)}_updatePolling(){this._pollingTimer&&this._pollingTimer.stop(),this.props.visibility===k.a.COLLAPSED&&(this._pollingTimer=new _e.a(this._fetchUpdatesIfNeeded,{interval:3e3}),this._pollingTimer.start())}getChildContext(){return{getCustomLocation:null}}}i()(ye,"childContextTypes",{getCustomLocation:ue.func});const Ie=z.a.create(e=>({root:{backgroundColor:e.colors.blue},expanded:{maxHeight:l.a.dmDrawerHeight.expanded,height:"80vh"}}));var Ce=M(ye),xe=a("4q8G"),we=a("kGix"),Se=a("tn7R");var Oe=Object(d.a)().propsFromState(()=>({fetchStatus:c.selectFetchStatus,conversations:c.selectConversations,isLoadingTop:c.selectIsLoadingTop,settings:I.f,unreadCount:f.a,untrustedConversationCount:c.selectUntrustedConversationCount,untrustedUnreadCount:c.selectUntrustedUnreadCount,visibility:c.selectDrawerVisibility})).adjustStateProps(({fetchStatus:e,conversations:t,isLoadingTop:a,settings:r,unreadCount:n,untrustedConversationCount:s,untrustedUnreadCount:i,visibility:o})=>{const l=!!Object.values(t).length,c=Object(Se.a)(t).filter(e=>{var t;return!e.isDeleted&&(null==(t=e.data)?void 0:t.trusted)}).map(e=>e.data).sort(xe.a),d=n>0;return{allowUntrustedInbox:"all"===r.allow_dms_from||s>0,conversationIds:c.map(e=>e.conversation_id),fetchStatus:l?we.a.LOADED:e,isRefreshing:l&&a,isUnread:d,untrustedUnreadCount:i,visibility:o}}).propsFromActions(()=>({scribeAction:A.c,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_INBOX"),fetchInbox:c.fetchInbox,fetchInboxHistory:c.fetchTrustedInboxHistory,fetchInboxIfNeeded:c.fetchInboxIfNeeded,fetchUpdates:c.fetchUpdatesIfNeeded,googleAnalyticsPageView:A.a,scribePageImpression:A.d,updateLastSeenEventId:c.updateTrustedLastSeenEventId,popOutConversation:c.popOutConversation})).withAnalytics({page:"messages",section:"inbox_drawer"}),De=a("qS4/"),Me=a("yw4N"),Ne=a("FIs5"),He=a("csss");const Te=L.a.a2f8105f,Pe=L.a.b8aa3744,Ae=L.a.j06309e1,Re=L.a.gee5150a,ke=L.a.cf2d1047,Fe=L.a.da2f9224,je=L.a.h6beb5fa;class Le extends o.Component{constructor(...e){super(...e),i()(this,"_renderExpandedInbox",()=>{const{analytics:e,conversationIds:t,createLocalApiErrorHandler:a,fetchInbox:r,fetchInboxHistory:n,fetchInboxIfNeeded:s,fetchStatus:i,fetchUpdates:l,googleAnalyticsPageView:c,scribePageImpression:d,isRefreshing:h,scribeAction:m,updateLastSeenEventId:p}=this.props;return o.createElement(V.a,{style:Ue.fill},o.createElement(Me.a,{style:Ue.viewportView},o.createElement(De.a,{accessibilityTitle:Te,conversationIds:t,conversationPathPrefix:"/messages",createLocalApiErrorHandler:a,customCellClick:this._dmDrawerOnClick,fetchInbox:r,fetchInboxHistory:n,fetchInboxIfNeeded:s,fetchStatus:i,fetchUpdates:l,googleAnalyticsPageView:c,isRefreshing:h,renderEmptyDMInbox:this._renderEmptyDMInbox,renderStickyContent:this._renderPivot,scribeAction:m,scribeNamespace:e.contextualScribeNamespace,scribePageImpression:d,updateLastSeenEventId:p,virtualScrollerCacheKey:"dmDrawerInbox"})))}),i()(this,"_renderEmptyDMInbox",()=>o.createElement(Ne.a,{buttonLink:"/messages/compose",buttonText:Re,header:Pe,message:Ae,onImpression:this._handleEmptyDMInboxImpression})),i()(this,"_isExpanded",()=>{const{visibility:e}=this.props;return e===k.a.EXPANDED}),i()(this,"_dmDrawerOnClick",(e,t)=>{const{popOutConversation:a}=this.props;a(t),e.preventDefault()}),i()(this,"_handleEmptyDMInboxImpression",()=>{const{scribeAction:e,analytics:t}=this.props;e(Object.assign({},t.contextualScribeNamespace,{component:"empty_message",action:"impression"}))}),i()(this,"_handleRequestsPivotClick",()=>{const{scribeAction:e,analytics:t}=this.props;e(Object.assign({},t.contextualScribeNamespace,{element:"requests_pivot",action:"click"}))}),i()(this,"_renderPivot",()=>{const{allowUntrustedInbox:e}=this.props;return e?o.createElement(V.a,{style:Ue.requestPivotContainer},o.createElement(He.a,{label:ke,link:"/messages/requests",onPress:this._handleRequestsPivotClick,renderRightContent:this._renderPivotBadge,withBottomBorder:!1})):null}),i()(this,"_renderPivotBadge",()=>{const{untrustedUnreadCount:e}=this.props;return e>0?o.createElement(G.a,{count:e,standalone:!0,truncatedCountFormatter:je,unreadCountLabel:Fe}):null})}componentDidUpdate(){this._isExpanded()&&Object(H.a)()}render(){const{analytics:e,history:t,isUnread:a,isHeaderHighlighted:r,onDrawerOpen:n,triggerHeaderHighlight:s}=this.props,i=this._isExpanded();return o.createElement(V.a,{style:i&&Ue.expanded},o.createElement(pe,{hasNewMessages:a,history:t,isHighlighted:r,onDrawerOpen:n,scribeNamespace:e.contextualScribeNamespace,triggerHighlight:s}),i&&this._renderExpandedInbox())}}const Ue=z.a.create(e=>({expanded:{maxHeight:l.a.dmDrawerHeight.expanded,height:"80vh"},fill:{flex:1,alignSelf:"stretch"},requestPivotContainer:{backgroundColor:e.colors.cellBackground,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,zIndex:2},viewportView:Object.assign({},z.a.absoluteFillObject,{overflowY:"auto"})}));var Be=Oe(Le),Ve=a("YeIG"),We="DMDrawer",Ge=a("TnY3"),$e=a("0FVZ"),qe=a("Oe3h");class ze extends o.PureComponent{constructor(...e){super(...e),i()(this,"state",{isHeaderHighlighted:!1,hasStartedInitialFetch:!1}),i()(this,"_showDMDrawer",()=>{const{conversations:e,visibility:t}=this.props,a=t===k.a.CLOSED;return!this._isHideDMDrawerPath()&&!Object(Ve.a)(e)&&!a}),i()(this,"_isExpanded",()=>{const{visibility:e}=this.props;return e===k.a.EXPANDED}),i()(this,"_triggerHeaderHighlight",()=>{const{isHeaderHighlighted:e}=this.state;this._isExpanded()||e||this._headerHighlightTimeoutId||(this.setState({isHeaderHighlighted:!0}),this._headerHighlightTimeoutId=setTimeout(()=>{this.setState({isHeaderHighlighted:!1}),this._headerHighlightTimeoutId=void 0},3e3))}),i()(this,"_handleDrawerOpen",()=>{const{isHeaderHighlighted:e}=this.state;e&&(this.setState({isHeaderHighlighted:!1}),clearTimeout(this._headerHighlightTimeoutId),this._headerHighlightTimeoutId=void 0)}),i()(this,"_isOnOcfFlow",()=>{const{location:e}=this.props;return e.pathname.startsWith("/i/flow")}),i()(this,"_isOnBirdwatchPage",()=>{const{location:e}=this.props;return e.pathname.startsWith("/i/birdwatch")}),i()(this,"_isHideDMDrawerPath",()=>this._isOnOcfFlow()||this._isOnBirdwatchPage())}componentWillUnmount(){clearTimeout(this._headerHighlightTimeoutId)}componentDidUpdate(){this._loadInboxDataIfNeeded()}componentDidMount(){this._loadInboxDataIfNeeded()}render(){const{history:e,location:t,perspective:a,poppedOutConversationId:r,width:s}=this.props,{isHeaderHighlighted:i}=this.state;return this._showDMDrawer()?o.createElement($e.a.Drawer,null,o.createElement(qe.a,null,(l,c)=>o.createElement(V.a,n()({ref:l()},c({style:[Ke.root,{width:s}],testID:We})),r?o.createElement(Ce,{conversationId:r,history:e,isHeaderHighlighted:i,location:t,onDrawerOpen:this._handleDrawerOpen,perspective:a,triggerHeaderHighlight:this._triggerHeaderHighlight}):o.createElement(Be,{history:e,isHeaderHighlighted:i,onDrawerOpen:this._handleDrawerOpen,triggerHeaderHighlight:this._triggerHeaderHighlight})))):null}_loadInboxDataIfNeeded(){const{fetchInboxIfNeeded:e,createLocalApiErrorHandler:t,loadDrawerExperimentFromPersistence:a,loadDrawerVisibilityFromPersistence:r}=this.props,{hasStartedInitialFetch:n}=this.state;this._isHideDMDrawerPath()||n||(r(),a(),e().catch(t()),this.setState({hasStartedInitialFetch:!0}))}}i()(ze,"defaultProps",{width:l.a.dmDrawerWidth.max});const Ke=z.a.create(e=>({root:{alignSelf:"flex-end",backgroundColor:e.colors.navigationBackground,borderTopLeftRadius:e.borderRadii.large,borderTopRightRadius:e.borderRadii.large,boxShadow:e.boxShadows.medium,marginRight:e.spaces.medium,minWidth:l.a.dmDrawerWidth.min,maxWidth:l.a.dmDrawerWidth.max}})),Qe=p(ze);t.default=Object(Ge.a)(Qe)},"qS4/":function(e,t,a){"use strict";a("IAdD"),a("kYxP");var r=a("KEM+"),n=a.n(r),s=a("ERkP"),i=a("BUB3"),o=a("s14A"),l=(a("x4t0"),a("MMRb")),c=a("0KEI"),d=a("hqKg"),h=a("AQOc"),m=a("G6rE"),p=a("oEGd");const u=(e,t)=>t.conversationId,g=Object(d.createSelector)(u,(e,t)=>l.selectConversation(e,u(0,t)),l.selectEntries,m.e.selectAll,(e,t)=>!l.selectConversationIsRead(e,u(0,t)),(e,t,a,r,n)=>({conversation:t&&Object(h.a)(t.data,a,r),conversationId:e,unread:n})),b={createLocalApiErrorHandler:Object(c.d)("DIRECT_MESSAGES_INBOX_ITEM"),leaveConversation:l.leaveConversation};var E=Object(p.g)(g,b),_=a("aA19"),v=a("OhSZ"),f=a("t62R"),y=a("g54k");const I=Object(d.createSelector)(m.e.selectAll,(e,t)=>t.entry,y.b);var C=Object(p.c)(I),x=a("zQEV");a("AxOO"),a("aWzz");var w=C(({entry:e,entryType:t,perspective:a,users:r})=>{const n=Object(x.a)(e,t,a,r);return s.createElement(f.c,{color:"deepGray"},n)});const S=Object(d.createSelector)((e,t)=>m.e.select(e,t.senderId),(e,t)=>t.recipientId?m.e.select(e,t.recipientId):void 0,(e,t)=>({user:e,recipient:t}));var O=Object(p.c)(S),D=a("cTG8"),M=a("3XMw"),N=a.n(M);const H=e=>s.createElement(N.a.I18NFormatMessage,{$i18n:"b3a2b11c"},s.createElement(f.c,null,e)),T=N.a.a876e58b,P=N.a.bf584cd1,A=N.a.a9cc8cfd,R=N.a.e20b65b0,k=N.a.e5bfe07d,F=N.a.b1a614fe;var j=O(({entry:e,perspective:t,isGroupDM:a,user:r={},recipient:n={}})=>{const i=e&&e.message_data;if(!i)return null;const{attachment:o={}}=i,l=!!(o.video||o.photo||o.animated_gif||o.tweet||o.fleet||o.sticker||o.card),c=t===r.id_str,d=!(!l||!c)||!(!a||c),h=r.name,m=n.name;let p=[d&&s.createElement(f.c,{key:"senderName"},H(h)," "),i&&i.text&&s.createElement(D.a,{displayTextRange:[0,i.text.length],entities:i.entities,key:"message",text:i.text,withMediaLinks:!0})];return o.tweet?p=d?((e,t)=>e?s.createElement(f.c,null,N.a.d5b762c8):s.createElement(N.a.I18NFormatMessage,{$i18n:"dfd2b3b9"},s.createElement(f.c,null,t)))(c,h):F:o.fleet?p=((e,t,a)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"i005f1fd"},s.createElement(f.c,null,t),s.createElement(f.c,null,a||"")):s.createElement(N.a.I18NFormatMessage,{$i18n:"b35cee40"},s.createElement(f.c,null,a||"")))(c,m,i.text):o.video?p=d?((e,t)=>e?s.createElement(f.c,null,N.a.j7d81019):s.createElement(N.a.I18NFormatMessage,{$i18n:"eee2f120"},s.createElement(f.c,null,t)))(c,h):T:o.photo?p=d?((e,t)=>e?s.createElement(f.c,null,N.a.f80629ba):s.createElement(N.a.I18NFormatMessage,{$i18n:"c1e1f848"},s.createElement(f.c,null,t)))(c,h):P:o.animated_gif?p=d?((e,t)=>e?s.createElement(f.c,null,N.a.eb3d722e):s.createElement(N.a.I18NFormatMessage,{$i18n:"dc4b75a1"},s.createElement(f.c,null,t)))(c,h):A:o.sticker?p=d?((e,t)=>e?s.createElement(f.c,null,N.a.d30c2d4f):s.createElement(N.a.I18NFormatMessage,{$i18n:"c7e2464e"},s.createElement(f.c,null,t)))(c,h):R:o.card&&(p=d?((e,t)=>e?s.createElement(f.c,null,N.a.db53c017):s.createElement(N.a.I18NFormatMessage,{$i18n:"hcbbbb34"},s.createElement(f.c,null,t)))(c,h):k),s.createElement(f.c,{color:"deepGray",numberOfLines:1},p)}),L=a("uKEd");const U=(e,t)=>t.senderId?m.e.select(e,t.senderId):void 0,B=(e,t)=>Object(L.n)(e,t.reactionEntry.message_id),V=(e,t)=>{const a=B(e,t);return a&&a.message_data&&m.e.select(e,a.message_data.sender_id)};var W=Object(p.e)(()=>Object(d.createSelector)(U,B,V,(e,t,a)=>({reactedMessageEntry:t,reactingUser:e,messageUser:a})),{}),G=a("33Kz");var $=W(({isGroupDM:e,messageUser:t,perspective:a,reactionEntry:r,reactedMessageEntry:n,reactingUser:i})=>{const o=n&&n.message_data,l=o&&o.attachment,c=o&&o.text,d=t&&t.screen_name,h=a===(i&&i.id_str),m=i&&i.name,p=Object(G.b)(r.reaction_key||"");let u;return u=l&&l.tweet?e?((e,t,a,r)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"c4202784"},s.createElement(f.c,null,a),s.createElement(f.c,null,r)):s.createElement(N.a.I18NFormatMessage,{$i18n:"b493a890"},s.createElement(f.c,null,t),s.createElement(f.c,null,a),s.createElement(f.c,null,r)))(h,m,d,p):((e,t,a)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"ca684bf5"},s.createElement(f.c,null,a)):s.createElement(N.a.I18NFormatMessage,{$i18n:"h5797be5"},s.createElement(f.c,null,t),s.createElement(f.c,null,a)))(h,m,p):l&&l.video?e?((e,t,a,r)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"d1f8bdd9"},s.createElement(f.c,null,a),s.createElement(f.c,null,r)):s.createElement(N.a.I18NFormatMessage,{$i18n:"d764af97"},s.createElement(f.c,null,t),s.createElement(f.c,null,a),s.createElement(f.c,null,r)))(h,m,d,p):((e,t,a)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"ab1cdfe2"},s.createElement(f.c,null,a)):s.createElement(N.a.I18NFormatMessage,{$i18n:"f0cf1699"},s.createElement(f.c,null,t),s.createElement(f.c,null,a)))(h,m,p):l&&l.photo?e?((e,t,a,r)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"hec0fd4d"},s.createElement(f.c,null,a),s.createElement(f.c,null,r)):s.createElement(N.a.I18NFormatMessage,{$i18n:"j55320de"},s.createElement(f.c,null,t),s.createElement(f.c,null,a),s.createElement(f.c,null,r)))(h,m,d,p):((e,t,a)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"jf27606a"},s.createElement(f.c,null,a)):s.createElement(N.a.I18NFormatMessage,{$i18n:"cd110359"},s.createElement(f.c,null,t),s.createElement(f.c,null,a)))(h,m,p):l&&l.animated_gif?e?((e,t,a,r)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"e70dcc35"},s.createElement(f.c,null,a),s.createElement(f.c,null,r)):s.createElement(N.a.I18NFormatMessage,{$i18n:"g1bf440b"},s.createElement(f.c,null,t),s.createElement(f.c,null,a),s.createElement(f.c,null,r)))(h,m,d,p):((e,t,a)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"b2da1bf8"},s.createElement(f.c,null,a)):s.createElement(N.a.I18NFormatMessage,{$i18n:"g84c0421"},s.createElement(f.c,null,t),s.createElement(f.c,null,a)))(h,m,p):l&&l.card?e?((e,t,a,r)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"cd2e7c18"},s.createElement(f.c,null,a),s.createElement(f.c,null,r)):s.createElement(N.a.I18NFormatMessage,{$i18n:"aee9e7fa"},s.createElement(f.c,null,t),s.createElement(f.c,null,a),s.createElement(f.c,null,r)))(h,m,d,p):((e,t,a)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"f9fb1cf6"},s.createElement(f.c,null,a)):s.createElement(N.a.I18NFormatMessage,{$i18n:"f2bf910e"},s.createElement(f.c,null,t),s.createElement(f.c,null,a)))(h,m,p):c?e?((e,t,a,r,n)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"i6cec545"},s.createElement(f.c,null,r),s.createElement(f.c,null,a),s.createElement(f.c,null,n)):s.createElement(N.a.I18NFormatMessage,{$i18n:"d6998baa"},s.createElement(f.c,null,t),s.createElement(f.c,null,r),s.createElement(f.c,null,a),s.createElement(f.c,null,n)))(h,m,p,d,c):((e,t,a,r)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"cec676f3"},s.createElement(f.c,null,a),s.createElement(f.c,null,r)):s.createElement(N.a.I18NFormatMessage,{$i18n:"a2706f9a"},s.createElement(f.c,null,t),s.createElement(f.c,null,a),s.createElement(f.c,null,r)))(h,m,p,c):((e,t,a)=>e?s.createElement(N.a.I18NFormatMessage,{$i18n:"d6b15bbf"},s.createElement(f.c,null,a)):s.createElement(N.a.I18NFormatMessage,{$i18n:"ac0d4bc7"},s.createElement(f.c,null,t),s.createElement(f.c,null,a)))(h,m,p),s.createElement(f.c,{color:"deepGray",numberOfLines:1},u)}),q=a("H4nC"),z=a("b9JY");const K=N.a.fb3ccb55;var Q=({conversationType:e,entry:t,perspective:a})=>{if(t.marked_as_spam)return s.createElement(f.c,{color:"deepGray",numberOfLines:1},K);if(Object(z.b)(t)){const{message_data:{sender_id:r,recipient_id:n}={}}=t;return s.createElement(j,{entry:t,isGroupDM:e===l.CONVERSATION_TYPE.GROUP,perspective:a,recipientId:n,senderId:r})}return Object(z.c)(t)?s.createElement($,{isGroupDM:e===l.CONVERSATION_TYPE.GROUP,perspective:a,reactionEntry:t,senderId:t.sender_id}):Object(z.a)(t)?s.createElement(w,{entry:t,entryType:t.type,perspective:a}):Object(z.d)(t)?s.createElement(q.a,{entry:t,isCompact:!0}):null},X=a("wrlS"),Y=a("Myq3"),J="conversation",Z=a("MWbm"),ee=a("Irs7"),te=a("0PHd"),ae=a("/yvb"),re=a("eb3s"),ne=a("GBcw"),se=a("htQn"),ie=a("5mJL"),oe=a("rHpw"),le=a("aWyx"),ce=a("hiGS"),de=a("Lsrn"),he=a("k/Ka");const me=(e={})=>Object(he.a)("svg",Object.assign({},e,{style:[de.a.root,e.style],viewBox:"0 0 24 24"}),s.createElement("g",null,s.createElement("path",{d:"M22.238 2.257c-.293-.293-.768-.293-1.06 0L2.52 20.917c-.293.292-.293.767 0 1.06.146.146.338.22.53.22s.384-.073.53-.22l18.658-18.66c.293-.293.293-.767 0-1.06zM2.986 17.82c.155 0 .312-.048.446-.148.112-.083 2.752-2.104 2.708-7.248-.02-2.16.643-3.98 1.913-5.266 1.093-1.107 2.577-1.72 4.18-1.727 1.325.006 2.562.42 3.578 1.195.137.104.297.153.455.153.227 0 .45-.102.598-.295.25-.33.188-.8-.142-1.052-1.278-.975-2.828-1.493-4.483-1.5h-.003c-2.008.008-3.87.78-5.248 2.173-1.536 1.551-2.368 3.8-2.348 6.332.037 4.33-2.02 5.967-2.103 6.03-.332.247-.4.718-.154 1.05.147.2.374.303.603.303zm16.844-7.382c.002-.246-.003-.487-.017-.723-.024-.414-.387-.74-.792-.706-.413.023-.728.378-.705.79.012.205.017.413.015.624-.024 2.868.785 4.765 1.526 5.896h-8.314c-.414 0-.75.336-.75.75s.336.75.75.75h3.522c-.1 1.48-1.323 2.66-2.828 2.66-1.003 0-1.913-.514-2.436-1.372-.214-.354-.675-.467-1.03-.25-.354.214-.467.675-.25 1.03.795 1.31 2.185 2.09 3.716 2.09 2.332 0 4.227-1.85 4.328-4.158h4.922c.32 0 .604-.206.707-.51.104-.305 0-.643-.255-.84-.087-.066-2.145-1.7-2.108-6.032z"})));me.metadata={width:24,height:24};var pe=me;const ue=N.a.gdf4b79f,ge=N.a.bbf83d83,be=N.a.d96cf7cd,Ee={component:"low_quality_timeline"},_e=({children:e})=>s.createElement(Z.a,{style:fe.socialProofContainer},e);class ve extends s.Component{constructor(...e){super(...e),n()(this,"_socialProofEnabled",X.a.isTrue("responsive_web_dm_health_inbox_request_cell_social_proof_enabled")),n()(this,"state",{showConfirmation:!1}),n()(this,"_renderSocialProof",({social_proof:e})=>{if(!e||0===e.length)return null;const t=e[0];switch(t.proof_type){case le.d.MUTUAL_FRIENDS:{if(0===t.total)return null;const e=t.users.map(({profile_image_url_https:e})=>e),a=t.users.map(({name:e})=>e);return s.createElement(_e,null,s.createElement(te.a,{displayFacepileInline:!0,knownFollowersAvatarUrls:e,knownFollowersCount:t.total,knownFollowersNames:a}))}default:return null}}),n()(this,"_renderTrashcan",()=>{const{conversationId:e}=this.props;return s.createElement(s.Fragment,null,s.createElement(ae.a,{accessibilityLabel:be,borderColor:"transparent",icon:s.createElement(ce.a,{style:fe.trashcanIcon}),onPress:this._handleShowConfirmation,type:"destructiveText"}),this.state.showConfirmation?s.createElement(re.a,{confirmButtonLabel:be,confirmButtonType:"destructive",headline:ue,onCancel:this._handleHideConfirmation,onConfirm:this._deleteConversation(e),text:ge}):null)}),n()(this,"_renderTimestamp",()=>{const{conversation:e}=this.props;return s.createElement(s.Fragment,null,s.createElement(Z.a,null,e?s.createElement(ne.a,{timestamp:Number(e.sort_timestamp)}):null,(null==e?void 0:e.notifications_disabled)?s.createElement(pe,{style:fe.notificationsDisabledIcon}):null))}),n()(this,"_deleteConversation",e=>()=>{const{analytics:t,createLocalApiErrorHandler:a,leaveConversation:r}=this.props;this._handleHideConfirmation(),t.scribe(Object.assign({},Ee,{element:"thread",action:"delete_thread"})),r({conversationId:e}).catch(a({showToast:!0}))}),n()(this,"_handleHideConfirmation",()=>{this.setState({showConfirmation:!1})}),n()(this,"_handleOnClick",e=>{const{conversationId:t,onClick:a}=this.props;a(e,t)}),n()(this,"_handleShowConfirmation",e=>{const{analytics:t}=this.props;e.stopPropagation(),t.scribe(Object.assign({},Ee,{element:"accessory_trashcan",action:"click"})),this.setState({showConfirmation:!0})})}shouldComponentUpdate(e,t){const a=this.props.conversation,r=null==a?void 0:a.conversation_id,n=null==a?void 0:a.last_read_event_id,s=null==a?void 0:a.sort_event_id,i=null==a?void 0:a.max_entry_id,o=e.conversation,l=null==o?void 0:o.conversation_id,c=null==o?void 0:o.last_read_event_id,d=null==o?void 0:o.sort_event_id,h=null==o?void 0:o.max_entry_id,{filter:m,isActive:p}=this.props,{filter:u,isActive:g}=e,{showConfirmation:b}=this.state,{showConfirmation:E}=t;return r!==l||n!==c||s!==d||i!==h||p!==g||b!==E||m!==u}render(){const{conversation:e,filter:t,isActive:a,isTertiaryInbox:r,perspective:n,unread:i,link:o}=this.props,l=(null==e?void 0:e.entries)||[],c=Object(Y.a)(l,e=>![le.b.MESSAGE_DELETE,le.b.REACTION_DELETE,le.b.MESSAGE_MARK_AS_SPAM,le.b.MESSAGE_MARK_AS_NOT_SPAM].includes(e.type)),d=[fe.root,fe.bottomBorder,i&&fe.unread];if(!e||!t(e))return null;const h=!e.trusted&&this._socialProofEnabled;return s.createElement(se.a,{accessibilityRole:"tab",accessibilityState:{selected:a},link:{pathname:o,anchorless:!0},onPress:this._handleOnClick,style:d,testID:J},s.createElement(ie.a,{avatarCell:s.createElement(_.a,{conversation:e,perspective:n})},s.createElement(Z.a,{style:fe.bodyColumn},s.createElement(Z.a,{style:fe.titleContainer},s.createElement(v.b,{conversation:e,perspective:n}),s.createElement(Z.a,{style:fe.snippet},c?s.createElement(Q,{conversationType:e.type,entry:c,perspective:n}):null),h?this._renderSocialProof(e):null),r?this._renderTrashcan():this._renderTimestamp())))}}n()(ve,"defaultProps",{isActive:!1,filter:e=>!0,unread:!1});const fe=oe.a.create(e=>({root:{backgroundColor:e.colors.cellBackground,paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.small,width:"100%"},bottomBorder:{borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor},bodyColumn:{flexDirection:"row"},titleContainer:{flex:1},notificationsDisabledIcon:{alignSelf:"flex-end",color:e.colors.deepGray,paddingTop:e.spaces.xxSmall},trashcanIcon:{color:e.colors.red},snippet:{maxHeight:e.spaces.xLarge,overflow:"hidden"},unread:{backgroundColor:e.colors.unreadCellBackground},socialProofContainer:{marginTop:e.spaces.xxSmall}}));var ye=Object(ee.a)(E(ve),{page:"messages",section:"inbox"}),Ie=a("dwig"),Ce=a("v//M"),xe=a("QB0K"),we=a("Avzu"),Se=a("FRNI");const Oe=N.a.dabdea6b,De=N.a.f325afc3;class Me extends s.PureComponent{render(){return s.createElement(xe.a,{accessibilityLabel:Oe,href:"/messages/compose",icon:s.createElement(we.a,null),label:Oe,scribeComponent:"floating_dm_button",shortLabel:De,testID:Se.a.message})}}var Ne=Me,He=a("VwDm"),Te=a("VPAj"),Pe=a("IRWI");var Ae=Object.assign({},Pe.a,{initialScrollHeadroom:Object(Te.a)(0),scrollHeadroom:Object(Te.a)(0),pinToTopWhenAtTop:!0}),Re=a("TEoO"),ke=a("v6aA"),Fe=a("IG4P"),je=a("GSsg"),Le=a("2g+p"),Ue=a("6OUF"),Be=a("mw9i"),Ve=a("VY6S"),We=a("+d3d");const Ge=e=>e,$e=N.a.a66ac766,qe=N.a.fe61929d;class ze extends s.Component{constructor(e,t){super(e,t),n()(this,"state",{filterQuery:""}),n()(this,"_render",()=>{const{accessibilityTitle:e,conversationIds:t,footer:a,isRefreshing:r,renderEmptyDMInbox:n,renderStickyContent:i,virtualScrollerCacheKey:l}=this.props;return s.createElement(s.Fragment,null,i?i():null,this._enableSearchInbox?s.createElement(Z.a,{style:Ke.searchInput},s.createElement(Ue.a,{Icon:He.a,onChange:this._handleSearchChange,onClear:this._handleSearchClear,onFocus:this._handleSearchFocus,placeholder:qe,withClearButton:!0})):null,s.createElement(o.a,null,s.createElement(Fe.a,{isRefreshing:r,onRefresh:this._handlePullToRefresh},l&&t?s.createElement(Re.a,{accessibilityRole:"tablist",accessibilityTitle:e,anchoring:Ae,assumedItemHeight:100,cacheKey:l,footer:a,identityFunction:Ge,items:t,noItemsRenderer:n,onNearEnd:this._handleNearEnd,renderer:this._renderInboxItem(this.state.filterQuery)}):null)))}),n()(this,"_handleNearEnd",()=>{this.state.filterQuery||this._handleHistoryRequest()}),n()(this,"_handleSearchChangeInner",e=>{const{scribeAction:t,scribeNamespace:a}=this.props;this.setState({filterQuery:e.toLowerCase()}),t(Object.assign({},a,{element:"thread",action:"search"}),{event_value:this.state.filterQuery.length})}),n()(this,"_handleSearchChangeDebounced",Object(Ve.a)(this._handleSearchChangeInner,200)),n()(this,"_handleSearchChange",({currentTarget:{value:e}})=>this._handleSearchChangeDebounced(e)),n()(this,"_handleSearchClear",()=>this._handleSearchChangeInner("")),n()(this,"_handleSearchFocus",()=>{this.props.conversationIds&&this.props.conversationIds.length<30&&this._handleHistoryRequest()}),n()(this,"_renderInboxItem",e=>t=>{const{loggedInUserId:a}=this.context,{conversationPathPrefix:r,isTertiaryInbox:n}=this.props,o=this._filterConversation(e),l=`${r}/${t}`;return s.createElement(i.a,{exact:!1,path:l},e=>s.createElement(ye,{conversationId:t,filter:o,isActive:e,isTertiaryInbox:n,key:t,link:l,onClick:this._handleConversationClick,perspective:a}))}),n()(this,"_filterConversation",e=>e=>{const{filterQuery:t}=this.state;if(!t)return!0;const{loggedInUserId:a}=this.context,r=Object.keys(e.participants),n="GROUP_DM"===e.type&&e.name&&e.name.toLowerCase().indexOf(t)>-1,s=r.some(n=>{const s=e.participants[n],i=a===n,o=1===r.length&&i,l=s&&s.user&&!i;return!(!o&&!l)&&this._userMatchesQuery(s.user.screen_name,s.user.name,t)});return!(!n&&!s)}),n()(this,"_handleFetchInitialWrapper",()=>{this._handleFetchInitial()}),n()(this,"_handleFetchInitial",()=>{const{createLocalApiErrorHandler:e,fetchInboxIfNeeded:t,fetchUpdates:a}=this.props;return t().then(this._updateLastSeenEventId,e()).then(()=>{this._updatePolling.start()}).then(()=>a().catch(e()))}),n()(this,"_handleConversationClick",(e,t)=>{const{customCellClick:a,scribeAction:r,scribeNamespace:n}=this.props;r(Object.assign({},n,{element:"thread",action:"click"}),{event_value:this.state.filterQuery.length}),a&&a(e,t)}),n()(this,"_handleEmptyDMInboxImpression",()=>{const{scribeAction:e,scribeNamespace:t}=this.props;e(Object.assign({},t,{component:"empty_message",action:"impression"}))}),n()(this,"_handlePullToRefresh",()=>{const{createLocalApiErrorHandler:e,fetchInbox:t}=this.props;t().then(this._updateLastSeenEventId,e())}),n()(this,"_updateLastSeenEventIdIfActive",()=>{if("background"!==Le.a.currentState)return this._updateLastSeenEventId()}),n()(this,"_updateLastSeenEventId",()=>{const{createLocalApiErrorHandler:e,updateLastSeenEventId:t}=this.props;return t().catch(e())}),this._fab=s.createElement(Ne,null),this._enableSearchInbox=!!e.withDmSearch&&X.a.isTrue("responsive_web_search_dms_enabled")}componentDidMount(){const{createLocalApiErrorHandler:e,fetchInboxHistory:t,fetchUpdates:a,googleAnalyticsPageView:r,scribeNamespace:n,scribePageImpression:s}=this.props;return s(n),r(n),this._updatePolling=new je.a(()=>{a().then(this._updateLastSeenEventIdIfActive,e())},{interval:8e3}),this._handleHistoryRequest=Object(We.a)((...a)=>{t(...a).catch(e())},1e3),this._handleFetchInitial()}componentWillUnmount(){this._updatePolling.stop()}render(){return s.createElement(Ie.a,{component:Be.a,fab:this._fab,style:Ke.root},s.createElement(Ce.a,{accessibilityLabel:$e,fetchStatus:this.props.fetchStatus,onRequestRetry:this._handleFetchInitialWrapper,render:this._render}))}_userMatchesQuery(e,t,a){return e&&e.toLowerCase().indexOf(a)>-1||t&&t.toLowerCase().indexOf(a)>-1}}n()(ze,"contextType",ke.a),n()(ze,"defaultProps",{conversationIds:[],isTertiaryInbox:!1,withDmSearch:!1});const Ke=oe.a.create(e=>({root:{backgroundColor:e.colors.cellBackground,flexGrow:1},searchInput:{backgroundColor:e.colors.cellBackground,borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:"1px",padding:e.spaces.xSmall,zIndex:1}}));t.a=ze}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.DMDrawer.71b5f9f5.js.map