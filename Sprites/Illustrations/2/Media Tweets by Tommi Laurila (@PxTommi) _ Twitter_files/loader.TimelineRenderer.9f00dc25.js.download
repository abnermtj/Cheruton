(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{"3GUV":function(e,t,s){"use strict";var i=s("ERkP"),n=s("rHpw"),r=s("MWbm");class o extends i.Component{shouldComponentUpdate(){return!1}render(){return i.createElement(r.a,{style:a.root})}}const a=n.a.create(e=>({root:{height:5*parseInt(e.lineHeight,10)+"rem"}}));t.a=o},"5UID":function(e,t,s){"use strict";var i=s("ERkP"),n=s("3XMw"),r=s.n(n),o=s("rHpw"),a=(s("aWzz"),s("+/1j")),c=s("MWbm");const l=r.a.e5b0063d;let h=0;class d extends i.Component{constructor(){super(),this._listDomId="accessible-list-"+h,h+=1}render(){const{children:e,title:t}=this.props,s=l({title:t});return i.createElement(c.a,{accessibilityRole:"region","aria-labelledby":this._listDomId},i.createElement(a.a,{accessibilityRole:"heading","aria-level":1,nativeID:this._listDomId,style:o.a.visuallyHidden},t),i.createElement(c.a,{accessibilityLabel:s},e))}}t.a=d},JsJV:function(e,t,s){"use strict";var i=s("6/RC"),n=s("tI3i"),r=s.n(n),o=i.canUseDOM?window.location.href:"",a={addEventListener:function(){},removeEventListener:function(){},canOpenURL:function(){return Promise.resolve(!0)},getInitialURL:function(){return Promise.resolve(o)},openURL:function(e){try{return c(e),Promise.resolve()}catch(e){return Promise.reject(e)}},_validateURL:function(e){r()("string"==typeof e,"Invalid URL: should be a string. Was: "+e),r()(e,"Invalid URL: cannot be empty")}},c=function(e){i.canUseDOM&&(window.location=new URL(e,window.location).toString())};t.a=a},ainm:function(e,t,s){"use strict";s.r(t),s.d(t,"TimelineRenderer",(function(){return le}));s("IAdD"),s("kYxP");var i=s("KEM+"),n=s.n(i),r=s("n+Zb"),o=s("7nmT"),a=s.n(o),c=s("nfVA"),l=s("EhiH"),h=s("zrc3");const d=(e,t)=>{const s=Object(l.a)(e,e=>t.has(e.entryId));return s?s.entryId:void 0};var p=s("ERkP"),m=s("5UID"),u=s("1YZw"),_=s("rxPX"),y=Object(_.a)().propsFromActions(()=>({addToast:u.b})).withAnalytics(),b=s("KNCp"),f=s("lUZE");var g=Object.freeze({Icon:"Icon",IconSmall:"IconSmall",FullWidth:"FullWidth"}),v=s("caTy"),C=s("TnY3"),I=s("TIdA"),E=s("A91F"),w=s("feu+"),T=s("JsJV"),R=s("MWbm"),x=s("oQhu"),S=s("fs1G"),A=s("rcen");class D extends p.PureComponent{constructor(...e){super(...e),n()(this,"_getGraphicProps",Object(x.a)((e,t)=>{const s=e?({style:t})=>p.createElement(R.a,{style:t},p.createElement(I.a,{accessibilityLabel:"",aspectMode:E.a.exact(e.width/e.height),image:e})):f.a;let i="illustration";return e&&t!==g.IconSmall?t===g.FullWidth&&(i="illustrationFullWidth"):i="icon",{graphic:s,graphicDisplayMode:i}})),n()(this,"_scribeAction",(e,t)=>{const{analytics:s}=this.props,{action:i,component:n,element:r}=t||{};s.scribe({action:i||e,component:n||"cover",element:r})}),n()(this,"_handleDismiss",()=>{const{dismissInfo:e,processCallback:t}=this.props,{callbacks:s,clientEventInfo:i}=e||{};s&&s.forEach(e=>{t(e)}),e&&(this._scribeAction("dismiss",i),this.props.onClose())}),n()(this,"_handlePrimaryCtaClick",()=>{this._handleCtaClick(this.props.primaryCta,"primary_cta")}),n()(this,"_handleSecondaryCtaClick",()=>{this.props.secondaryCta&&this._handleCtaClick(this.props.secondaryCta,"secondary_cta")}),n()(this,"_handleCtaClick",({ctaBehavior:e,callbacks:t,clientEventInfo:s},i)=>{const{addToast:n,processCallback:r,history:o}=this.props;if(this.props.onClose(),this._scribeAction("click",Object.assign({element:i},s)),e.dismiss){const{dismiss:t}=e;t&&t.feedbackMessage&&n({text:t.feedbackMessage.text})}if(e.navigate){const{navigate:t}=e,s=t&&Object(v.b)(t.url);s&&(s.external?T.a.openURL(s.pathname):o.push(s.pathname))}t&&t.forEach(e=>r(e))})}componentDidMount(){this.props.onImpression&&this.props.onImpression()}render(){const{image:e,imageDisplayType:t,primaryText:s,primaryCta:i,secondaryText:n,secondaryCta:r,details:o,displayType:a,type:c,dismissInfo:l}=this.props,h=p.createElement(A.b,{entities:s.entities,text:s.text}),d=n?p.createElement(A.b,{entities:n.entities,text:n.text}):null;if(c===b.a.Full){const c=o?p.createElement(A.b,{entities:o.entities,text:o.text}):null,{graphic:m,graphicDisplayMode:u}=this._getGraphicProps(e,t);return p.createElement(w.a,{actionLabel:i.text,footer:c,footerAlign:o&&o.alignment===A.a.Center?"center":"left",graphic:m,graphicDisplayMode:u,headline:h,headlineAlign:s.alignment===A.a.Natural?"left":"center",isFullHeightOnMobile:!l&&"CenterCover"!==a,onAction:this._handlePrimaryCtaClick,onClose:this._handleDismiss,onTertiaryAction:this._handleSecondaryCtaClick,subtext:d,subtextAlign:n&&n.alignment===A.a.Natural?"left":"center",tertiaryActionLabel:r&&r.text,withCloseButton:!!l})}return p.createElement(w.a,{actionLabel:i.text,graphicDisplayMode:"none",headline:h,headlineAlign:s.alignment===A.a.Center?"center":"left",onAction:this._handlePrimaryCtaClick,onClose:S.a,onSecondaryAction:this._handleSecondaryCtaClick,secondaryActionLabel:r&&r.text,subtext:d,subtextAlign:n&&n.alignment===A.a.Center?"center":"left",withCloseButton:!1})}}n()(D,"defaultProps",{imageDisplayType:g.Icon});var L=Object(C.a)(y(D)),O=s("3GUV"),j=s("8UdT"),P=s("wrlS"),k=s("MDbM"),M=s("v//M"),N=(s("C1yv"),s("Qyxo")),U=s("sXY3");class F{constructor(){this._lingerScribed={},this._appearance={}}processPositioningUpdate(e,t,s=Date.now()){const i=B(e,t);return this._lingerTransition(i,s)}flushLingerEvents(e=Date.now()){return this._detectLingerEvents(this._appearance,{},e)}_lingerTransition(e,t){const s={},i=this._appearance;return e.forEach(e=>{s[e]=i[e]||t}),this._appearance=s,this._detectLingerEvents(i,s,t)}_detectLingerEvents(e,t,s){return Object(N.a)(Object(U.a)(e),([e,i])=>!t[e]&&!this._lingerScribed[e]&&s-i>=500?(this._lingerScribed[e]=!0,{id:e,start:i,end:s}):void 0)}}const B=(e,t)=>Object(N.a)(e,({id:e,rectangle:s})=>H(s,t)>=.5*s.getHeight()?e:void 0),H=(e,t)=>Math.max(0,Math.min(e.getBottom(),t.getBottom())-Math.max(e.getTop(),t.getTop()));var W=s("OrGc"),V=s("hACr"),K=s("xjVt"),z=s("EUHl"),G=s("IG4P"),J=s("iBK2"),q=(s("rxtR"),s("aITJ")),Y=s("aWzz"),Z=s("VPAj"),X=s("/NU0"),Q=s("iChn"),$=s("+d3d"),ee=s("I7xG"),te=s("rHpw"),se=s("cFgU");const ie=e=>e.entryId,ne=e=>e.sortIndex;const re=Object(Z.a)(p.createElement(O.a,null)),oe=new Map,ae=()=>{const e=q.a.isDesktopOS()?P.a.getValue("responsive_web_vs_config_desktop_assumed_item_height"):void 0;return Object(X.a)(e)?e:void 0};let ce;class le extends p.PureComponent{constructor(e){super(e),n()(this,"_entryRefs",new Map),n()(this,"_adjustFocusBy",e=>{this._shouldPreventKeyboardShortcuts()||this._updateFocus((t,s,i)=>{let n=t&&((e,t,s,i)=>{const n=e?Object(h.a)(s,t=>t.entryId===e):-1;if(n>=0){for(let e=n>=0?n+t:0;e>=0&&e<s.length;e+=t){const{entryId:t}=s[e];if(i.has(t))return t}}return n>=0?e:void 0})(t,e,s,this._entryRefs);if(!n&&this._scroller){const e=this._scroller.findTopmostVisibleId();n=e?((e,t,s)=>{const i=Object(h.a)(t,t=>t.entryId===e);let n;if(i>=0){const e=Object(l.a)(t,e=>s.has(e.entryId),i);n=e?e.entryId:void 0}return n||(n=d(t,s)),n})(e,s,this._entryRefs):d(s,this._entryRefs)}return n})}),n()(this,"_focusNext",()=>this._adjustFocusBy(1)),n()(this,"_focusPrevious",()=>this._adjustFocusBy(-1)),n()(this,"_handleCoverImpression",()=>{const{activeCover:e,scribeAction:t,processCallback:s,scribeNamespace:i}=this.props;if(!e)return;const{clientEventInfo:n,cover:{impressionCallbacks:r}}=e;r&&r.forEach(e=>s(e));let o=Object.assign({},i,{component:"cover",action:"impression"});n&&(o=Object.assign({},o,{component:n.component||o.component,element:n.element||o.element,action:n.action||o.action})),t(o)}),n()(this,"_handleDismissCover",()=>{this.props.clearActiveCover()}),n()(this,"_renderLoadBottom",Object(ee.a)(this,e=>e.bottomFetchStatus,e=>e.onBottomRetry,(e,t)=>p.createElement(R.a,{style:he.footer},p.createElement(M.a,{fetchStatus:e,onRequestRetry:t,render:re})))),n()(this,"_refreshControlWrapper",e=>{const{canRefresh:t,refreshControl:s,topFetchStatus:i,onRefresh:n}=this.props;return s?p.createElement(s,{canRefresh:t,isRefreshing:i===k.a.LOADING,onRefresh:n},e):e}),n()(this,"_getCellRenderer",Object(x.a)((e,t)=>{let s;const i={module:t,renderEntry:e=>s(e),entryRef:this._setEntryRef};return s=t=>{const s=e.getHandler(t);return s&&s.render?s.render(t,i):null},s})),n()(this,"_setEntryRef",(e,t)=>{this._entryRefs.set(e,t)}),n()(this,"_getInitialFocusedEntry",Object(x.a)((e,t)=>t&&e.find(t))),n()(this,"_createEntryIndex",Object(x.a)(e=>Object(Q.a)(e,e=>e.entryId))),n()(this,"_handleBeforeWindowUnload",()=>{this._flushLingerScribes()}),n()(this,"scrollToTop",()=>{this._scroller&&(this._scroller.scrollToTop(),this._updateFocus((e,t,s)=>e?d(t,s):void 0))}),n()(this,"_shouldPreventKeyboardShortcuts",()=>{const{isModal:e}=this.context,{withKeyboardShortcuts:t}=this.props;return ce&&!e||!t}),n()(this,"_handleRefreshKeyboardShortcut",Object($.a)(()=>{this._shouldPreventKeyboardShortcuts()||this._refreshToTop()},1e3)),n()(this,"_handleAtBottom",this._proximityHandler(()=>{this.props.onAtBottom&&this.props.onAtBottom()})),n()(this,"_handleNearBottom",this._proximityHandler(()=>{this.props.onNearBottom()})),n()(this,"_handleNearTop",this._proximityHandler(()=>{const{onNearTop:e}=this.props;e()})),n()(this,"_handleAtTop",this._proximityHandler(()=>{this.props.removeAlert&&this.props.removeAlert(),this.props.onAtTop&&this.props.onAtTop()})),n()(this,"_handleItemsRendered",this._proximityHandler(({viewport:e,positions:t})=>{this._scribeLingerEvents(this._impressionTracker.processPositioningUpdate(t,e))})),n()(this,"_handlePositionRestored",()=>{this._positionedRestored=!0}),n()(this,"_scribeNewEntries",function(e){const t=window.requestIdleCallback||window.requestAnimationFrame;return s=>{t(()=>{e(s)})}}(e=>{const{richScribeAction:t,scribeNamespace:s}=this.props,i=this._buildStreamScribeData(e);if(i.length>0){t(Object.assign({},s,{component:"stream",action:"results"}),{items:i})}})),n()(this,"_setScroller",e=>{this._scroller=e}),this._impressionTracker=new F}UNSAFE_componentWillReceiveProps(e){this.props.timelineId!==e.timelineId&&(this._flushLingerScribes(),this._impressionTracker=new F)}componentDidMount(){const{isModal:e}=this.context;this._initialize(),window.addEventListener("beforelogout",this._handleBeforeWindowUnload),window.addEventListener("beforeunload",this._handleBeforeWindowUnload),this.props.onRef&&this.props.onRef(this),e&&(ce=!0)}componentWillUnmount(){const{isModal:e}=this.context;this._flushLingerScribes(),window.removeEventListener("beforelogout",this._handleBeforeWindowUnload),window.removeEventListener("beforeunload",this._handleBeforeWindowUnload),this.props.onRef&&this.props.onRef(void 0),e&&(ce=!1)}componentDidUpdate(e){const{entries:t,handlerRegistry:s,timelineId:i,onRef:n}=this.props;i!==e.timelineId?this._initialize():t===e.entries&&s===e.handlerRegistry||this._scribeNewEntries(t),n&&n!==e.onRef&&n(this)}_updateFocus(e){const t=e(this._activeEntryId,this.props.entries,this._entryRefs);if(t!==this._activeEntryId){this._activeEntryId=t;const e=this._activeEntryId&&this._entryRefs.get(this._activeEntryId);e&&((e,t)=>{const s=a.a.findDOMNode(e),i=s&&s.querySelector("a, [tabindex='0']");if(i){i.scrollIntoView(),i.focus();const e=(t||c.a.root()).getRect().getTop();e>0&&window.scrollBy(0,-1*e)}})(e,this.context.viewport)}}render(){const{activeCover:e,anchoring:t,entries:s,handlerRegistry:i,showFooter:n,header:o,isInitialFocusEntry:a,nearStartProximityRatio:c,renderEmptyState:l,timelineId:h,title:d,module:u}=this.props,_=this.props.scroller,y=this._getInitialFocusedEntry(s,a);return this._refreshControlWrapper(this._shouldRenderEmptyState(s)?l():p.createElement(m.a,{title:d},e?this._renderActiveCover():null,this._renderPill(),p.createElement(V.a,{handlers:{[W.d.loadNewTweets]:this._handleRefreshKeyboardShortcut,[W.d.nextItem]:this._focusNext,[W.d.previousItem]:this._focusPrevious}},p.createElement(_,{anchoring:t,assumedItemHeight:ae(),cacheKey:h,footer:n&&this._renderLoadBottom(),header:o,identityFunction:ie,initialAnchor:y&&r.b(ie(y)),items:s,nearStartProximityRatio:c,onAtEnd:this._handleAtBottom,onAtStart:this._handleAtTop,onItemsRendered:this._handleItemsRendered,onNearEnd:this._handleNearBottom,onNearStart:this._handleNearTop,onPositionRestored:this._handlePositionRestored,ref:this._setScroller,renderer:this._getCellRenderer(i,u),sortIndexFunction:ne}))))}_renderPill(){const{alert:e,removeAlert:t,topUnseenCount:s,newTweetsPillMode:i,scribeNamespace:n,timelineId:r}=this.props;return i?i===z.a.URT?p.createElement(K.a.Configure,{alert:e,removeAlert:t,scribeNamespace:n,timelineId:r}):i===z.a.CLIENT&&s&&s>0&&P.a.isTrue("responsive_web_tweets_pill_local_enabled")?p.createElement(K.a.Configure,{removeAlert:t,scribeNamespace:n,timelineId:r,unreadCount:s}):void 0:null}_renderActiveCover(){const{activeCover:e}=this.props,t=e&&e.cover;return e&&t?"full"===e.type?this._renderFullCover(e.cover):"half"===e.type?this._renderHalfCover(e.cover):null:null}_renderFullCover(e){const{processCallback:t}=this.props;return p.createElement(L,{details:e.details||void 0,dismissInfo:e.dismissInfo,displayType:e.displayType,image:e.image,imageDisplayType:e.imageDisplayType||void 0,onClose:this._handleDismissCover,onImpression:this._handleCoverImpression,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:t,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:"full"})}_renderHalfCover(e){const{processCallback:t}=this.props,s="CenterCover"===e.displayType?"full":"half";return p.createElement(L,{displayType:e.displayType,image:e.coverImage?e.coverImage.image:void 0,imageDisplayType:e.coverImage?e.coverImage.imageDisplayType:void 0,onClose:this._handleDismissCover,onImpression:this._handleCoverImpression,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:t,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:s})}_shouldRenderEmptyState(e){const{activeCover:t,initialFetchStatus:s}=this.props,i=s===k.a.LOADED,n=0===e.length;return i&&n&&!t}_getEntryIndex(){return this._createEntryIndex(this.props.entries)}_initialize(){this._scribeNewEntries(this.props.entries),this._activeEntryId=void 0}_flushLingerScribes(){this._scribeLingerEvents(this._impressionTracker.flushLingerEvents())}_refreshToTop(){this.props.onRefresh(),this.scrollToTop()}_proximityHandler(e){return t=>{this._positionedRestored&&e(t)}}_buildStreamScribeData(e){const{scribeCache:t,timelineId:s,handlerRegistry:i}=this.props;let n=null;if(!t.has(s)){const e=new Set;t.set(s,e)}const r=t.get(s);return r?e.reduce((e,t,s)=>{const{entryId:o}=t;let a=!1;if(t.content&&t.content.promotedMetadata&&(a=t.content.promotedMetadata),!r.has(o)&&!i.getNeedsLoad(t)){r.add(o);const s=this._getScribeDataItem(i,t);s&&(a&&null!==n&&(s.tweet_count=n),e.push(s))}return a?n=0:null!==n&&-1===t.type.indexOf("ui_")&&(n+=1),e},[]):[]}_storeSeenIds(e){const{seenIds:t,seenIdsLatest:s,timelineId:i}=this.props;"home"===i&&t?t.addNewTweets(e):"home-latest"===i&&s&&s.addNewTweets(e)}_scribeLingerEvents(e){if(0===e.length)return;const{handlerRegistry:t}=this.props,s=this._getEntryIndex(),i=[],n=[];if(e.forEach(({id:e,start:r,end:o})=>{const a=s[e];if(a){const e=this._getScribeDataItem(t,a);if(e){const t={visibility_start:r,visibility_end:o};i.push(Object.assign({},e,{impression_details:t}))}a.type===j.a.Tweet&&n.push(a.content.id)}}),i.length>0){const{richScribeAction:e,scribeNamespace:t}=this.props;e(Object.assign({},t,{component:"stream",element:"linger",action:"results"}),{items:i})}n.length>0&&this._storeSeenIds(n)}_getScribeDataItem(e,t){const s=e.getHandler(t);if(s)return s.getScribeDataItem(t)}}n()(le,"contextTypes",{viewport:Y.object,isModal:Y.bool}),n()(le,"defaultProps",{showFooter:!0,onBottomRetry:S.a,onNearBottom:S.a,onNearTop:S.a,onRefresh:S.a,refreshControl:G.a,scribeCache:oe,scroller:J.b,seenIds:Object(se.b)(),seenIdsLatest:Object(se.a)(),withKeyboardShortcuts:!0});const he=te.a.create(e=>({footer:{height:`calc(5 * ${e.lineHeight}rem)`}}));t.default=le},"n+Zb":function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return n}));const i=e=>({id:e,distanceToViewportTop:0}),n=e=>({id:e,distanceToViewportBottom:0})}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.TimelineRenderer.9f00dc25.js.map