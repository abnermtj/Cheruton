(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{u1Qz:function(e,t,o){"use strict";o.r(t),o.d(t,"TweetMediaDetailScreen",(function(){return le}));o("IAdD"),o("MvUL");var r=o("KEM+"),a=o.n(r),n=o("ERkP"),s=o("aWzz"),i=(o("WNMA"),o("zh9S")),d=o("rxPX"),c=o("0KEI"),l=o("H9MA"),h=o("XOJV"),p=o("P1r1");const w=(e,t)=>t.match.params.screenName,m=(e,t)=>t.match.params.statusId,u=(e,t)=>{const{match:{params:{index:o}}}=t;return parseInt(o,10)-1},_=(e,t)=>h.a.selectFetchStatus(e,m(0,t)),g=(e,t)=>e.location&&e.location.state&&e.location.state[t],M=(e,t)=>g(t,"promotedContent"),b=(e,t)=>g(t,"socialContext"),x=(e,t)=>g(t,"contextTweetId"),I=(e,t)=>{const o=m(0,t),r=h.a.select(e,o);return r&&r.conversation_id_str||void 0};var T=Object(d.a)().propsFromState(()=>({fetchStatus:_,index:u,screenName:w,tweetId:m,tweet:h.a.createHydratedTweetSelector(m),promotedContent:M,dataSaver:l.c,socialContext:b,contextTweetId:x,rootTweet:h.a.createHydratedTweetSelector(I),conversationTreeEnabled:p.h,showTweetMediaDetailDrawer:p.u})).propsFromActions(()=>({createLocalApiErrorHandler:Object(c.d)("TWEET_MEDIA_DETAIL_SCREEN"),fetchTweetIfNeeded:h.a.fetchOneIfNeeded,googleAnalyticsPageView:i.a,updateSettings:p.D})).withAnalytics({page:"tweet",section:"media"}),C=(o("kYxP"),o("ymux")),v=o("rkhm"),E=o("ZUOq");const S=E.a.columnWidths.secondary.normal,f=E.a.columnWidths.primary;var y=o("AUxQ"),D=o("yw4N"),O=o("I7xG"),k=o("rHpw");class L extends n.Component{constructor(...e){super(...e),a()(this,"_getApiErrorHandlerMap",Object(O.a)(this,e=>e.screenName,e=>Object(v.a)(e))),a()(this,"_getModule",Object(O.a)(this,e=>e.tweetId,e=>e.conversationTreeEnabled,(e,t)=>Object(C.a)({focalTweetId:e,conversationTreeEnabled:t})))}render(){const{contextTweetId:e,conversationTreeEnabled:t,location:o,tweet:r,tweetId:a,promotedContent:s,rootTweet:i,socialContext:d}=this.props,c={selectedTweetId:a};return n.createElement(D.a,{"aria-expanded":"true",style:P.root},n.createElement(y.a,{apiErrorHandlerMap:this._getApiErrorHandlerMap(),contextTweetId:e,conversationTreeEnabled:t,focalTweet:r,focalTweetId:a,location:o,module:this._getModule(),promotedContent:s,rootTweet:i,selectedTweet:c,socialContext:d,withFocalTweetMedia:!1}))}}const P=k.a.create(e=>({root:{backgroundColor:e.colors.cellBackground,overflow:"auto",width:S,borderLeftWidth:e.borderWidths.small,borderColor:e.colors.borderColor,borderStyle:"solid"}}));var N=L,R=o("v//M"),j=o("W5XZ"),A=o("RCZO"),B=o("3XMw"),H=o.n(B),W=o("2doW"),F=o("UPvq"),z=o("VTxf"),Z=o("wiP2"),X=o("Rp9C"),$=o("xXop"),U=o("lklz"),q=o("MWbm"),J=o("cHvH"),V=o("mjJ+"),K=o("rOXj"),G=o("/yvb"),Q=o("Lsrn"),Y=o("shC7"),ee=o("k/Ka");const te=(e={})=>Object(ee.a)("svg",Object.assign({},e,{style:[Q.a.root,e.style,Y.a.isRTL&&Q.a.iconRTL],viewBox:"0 0 24 24"}),n.createElement("g",null,n.createElement("path",{d:"M21.185 11.47l-9.25-9.25c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l8.72 8.72-8.72 8.72c-.294.294-.294.77 0 1.062.145.146.337.22.53.22s.383-.073.53-.22l9.25-9.25c.293-.295.293-.77 0-1.062z"}),n.createElement("path",{d:"M13.376 11.47l-9.25-9.25c-.293-.293-.768-.293-1.06 0s-.294.768 0 1.06l8.72 8.72-8.72 8.72c-.294.294-.294.77 0 1.062.146.145.337.218.53.218s.384-.073.53-.22l9.25-9.25c.293-.293.293-.767 0-1.06z"})));te.metadata={width:24,height:24};var oe=te;const re=(e={})=>Object(ee.a)("svg",Object.assign({},e,{style:[Q.a.root,e.style,Y.a.isRTL&&Q.a.iconRTL],viewBox:"0 0 24 24"}),n.createElement("g",null,n.createElement("path",{d:"M4.656 12l8.72-8.72c.293-.293.293-.768 0-1.06s-.768-.294-1.06 0l-9.25 9.25c-.294.292-.294.767 0 1.06l9.25 9.25c.145.146.337.22.53.22s.383-.073.53-.22c.292-.293.292-.768 0-1.06L4.655 12z"}),n.createElement("path",{d:"M12.465 12l8.72-8.72c.293-.293.293-.768 0-1.06s-.768-.294-1.06 0l-9.25 9.25c-.294.292-.294.767 0 1.06l9.25 9.25c.145.146.337.22.53.22s.383-.073.53-.22c.292-.293.292-.768 0-1.06L12.464 12z"})));re.metadata={width:24,height:24};var ae=re,ne=o("FRoe");const se=H.a.d132269b,ie=H.a.dd657211,de=H.a.h63a5c3b,ce=H.a.f20b040d;class le extends n.Component{constructor(e,t){super(e,t),a()(this,"_renderMediaModal",e=>{const{fetchStatus:t}=this.props,o=this._shouldHideButtons(),r=this._getCurrentMediaItem(),a=Object(A.b)(r),s=this._touchSupported&&this._isCurrentMediaItemPhoto();return n.createElement(F.a,{backgroundColor:a,footerButtons:this._renderFooter(),hideButtons:o,mediaItem:r,onCloseButtonPress:this._handleClose,overlayFooter:s,topRightButton:this._renderTopRightButton(e)},n.createElement(R.a,{accessibilityLabel:se,fetchStatus:t,onRequestRetry:this._handleFetchTweet,render:this._renderContent}))}),a()(this,"_renderMediaModalWithDrawer",()=>{const{contextTweetId:e,location:t,tweetId:o,tweet:r,promotedContent:a,rootTweet:s,socialContext:i,conversationTreeEnabled:d,screenName:c}=this.props;return n.createElement(J.a,null,({windowWidth:l})=>n.createElement(q.a,{style:he.container},n.createElement(q.a,{style:he.neighbor},this._renderMediaModal(l)),this._shouldShowMediaModalDrawer(l)?n.createElement(N,{contextTweetId:e,conversationTreeEnabled:d,location:t,promotedContent:a,rootTweet:s,screenName:c,socialContext:i,tweet:r,tweetId:o}):null))}),a()(this,"_shouldIgnoreShowDrawerSetting",e=>e-S<f),a()(this,"_shouldShowMediaModalDrawer",e=>{const{showTweetMediaDetailDrawer:t}=this.props,{showDrawerOnNarrowScreen:o}=this.state;return this._shouldIgnoreShowDrawerSetting(e)?o:t}),a()(this,"_handleToggleDrawer",e=>()=>{const{showTweetMediaDetailDrawer:t,updateSettings:o,analytics:r}=this.props,{showDrawerOnNarrowScreen:a}=this.state;e&&this._shouldIgnoreShowDrawerSetting(e)?(r.scribe({component:"conversation_drawer",action:a?"collapse":"expand"}),this.setState({showDrawerOnNarrowScreen:!a})):(r.scribe({component:"conversation_drawer",action:t?"collapse":"expand"}),o({showTweetMediaDetailDrawer:!t}))}),a()(this,"_getPermalink",()=>{const{tweet:e}=this.props;return e&&e.user?`/${e.user.screen_name}/status/${e.id_str}`:"/"}),a()(this,"_renderOverflowMenu",e=>n.createElement(V.a,{isFixed:!0,items:[{link:this._getPermalink(),text:ie}],onCloseRequested:e})),a()(this,"_getExtendedMedia",()=>{const e=this.props.location.state;if(!e)return;const t=e.mediaItems;return t&&"index"in t&&"items"in t?t:void 0}),a()(this,"_getIndex",()=>{const e=this._getExtendedMedia();return e?e.index:this.props.index}),a()(this,"_getMediaItems",()=>{const e=this._getExtendedMedia();if(e)return e.items;{const{tweet:e}=this.props;if(!e)return;return e.extended_entities&&e.extended_entities.media||e.card&&e.card.media}}),a()(this,"_getLocationState",e=>{const t=this._getExtendedMedia(),{location:o}=this.props;return t?Object.assign({},o.state,{mediaItems:Object.assign({},t,{index:e})}):o.state}),a()(this,"_isCurrentMediaItemPhoto",()=>{const e=this._getIndex(),t=this._getMediaItems();if(!t)return!1;const o=t[e];return o&&"photo"===o.type}),a()(this,"_handleMediaItemTapped",()=>{this._touchSupported&&this.setState(({showControls:e})=>({showControls:!e}))}),a()(this,"_renderContent",()=>{const{dataSaver:e,promotedContent:t,tweet:o}=this.props,r=this._getIndex(),a=this._getMediaItems();if(!a)return n.createElement(z.a,null);const s=a[r],i=Object(A.b)(s).rgb;return n.createElement(W.a,{dataSaver:e,dominantColor:i,mediaIndex:r,mediaItems:a,onDismiss:this._handleClose,onMediaDetailZoomed:this._handleMediaDetailZoomed,onMediaItemChanged:this._handleMediaItemChanged,onTap:this._handleMediaItemTapped,promotedContent:t,videoId:1===a.length&&o?U.b.forTweet(o.id_str):void 0})}),a()(this,"_handleClose",()=>{const{history:e,location:t}=this.props,o=this._getPermalink();e.goBackToNonModalRoute({fallbackPath:o,location:t})}),a()(this,"_getPermalink",()=>{const{tweet:e}=this.props;return e&&e.user?`/${e.user.screen_name}/status/${e.id_str}`:"/"}),a()(this,"_possiblyRedirectToCanonical",()=>{const{history:e,screenName:t,tweet:o}=this.props;if(o&&o.user&&t.toLowerCase()!==o.user.screen_name.toLowerCase()){const t=this._getCanonicalPath();t&&e.replace(t)}}),a()(this,"_getCanonicalPath",()=>{const{index:e,tweet:t}=this.props;return t&&t.user?`/${t.user.screen_name}/status/${t.id_str}/photo/${e+1}`:null}),a()(this,"_handleFetchTweet",()=>{const{createLocalApiErrorHandler:e,fetchTweetIfNeeded:t,tweetId:o}=this.props;t(o).catch(e(j.a))}),a()(this,"_handleMediaDetailZoomed",e=>{this.setState({isZoomed:e,showControls:!e})}),a()(this,"_handleMediaItemChanged",e=>{const{history:t,analytics:o}=this.props,r=this._getIndex(),a=this._getMediaItems();if(e===r)return;o.scribe({component:"gallery",element:r<e?"next":"prev",action:"click",data:{event_value:e+1}});const n=a&&a[e];t.replace({state:this._getLocationState(e),pathname:n&&n.expanded_url})}),a()(this,"_scribeImpression",()=>{const{analytics:e,googleAnalyticsPageView:t,tweet:o}=this.props;if(o){const r=X.a.getTweetItem(o);t(e.contextualScribeNamespace),e.scribe({action:"show",data:{items:[r]}})}}),this.state={showControls:!0,showDrawerOnNarrowScreen:!1,isZoomed:!1},this._touchSupported=K.a.isTouchSupported()}componentDidMount(){this._handleFetchTweet(),this._scribeImpression()}componentDidUpdate(e){var t,o;this._possiblyRedirectToCanonical(),e.tweetId!==this.props.tweetId&&this._handleFetchTweet(),(null==(t=e.tweet)?void 0:t.id_str)!==(null==(o=this.props.tweet)?void 0:o.id_str)&&this._scribeImpression()}render(){return n.createElement(Z.a.Configure,{headerless:!0},this.context.isModal?this._renderMediaModalWithDrawer():this._renderMediaModal())}_getCurrentMediaItem(){const e=this._getIndex(),t=this._getMediaItems();return t&&t[e]}_shouldHideButtons(){const{isZoomed:e,showControls:t}=this.state;return e||!t}_renderTopRightButton(e){const{tweet:t}=this.props,{isModal:o}=this.context,r=this._getCurrentMediaItem(),a=Object(A.b)(r),s=e&&this._shouldShowMediaModalDrawer(e);return o?n.createElement(G.a,{accessibilityLabel:s?ce:ie,dominantColor:a.rgb,icon:s?n.createElement(oe,null):n.createElement(ae,null),onClick:this._handleToggleDrawer(e),type:"onMedia"}):t&&!o?n.createElement(G.a,{accessibilityLabel:de,dominantColor:r?a.rgb:void 0,icon:n.createElement(ne.a,null),renderMenu:this._renderOverflowMenu,type:r?"onMedia":"invertedPrimary"}):void 0}_renderFooter(){const{tweet:e}=this.props;return e?n.createElement($.a,{actionSize:"large",activeColor:"white",color:"white",style:he.actionsBar,tweet:e,withCount:!0}):void 0}}a()(le,"contextTypes",{isModal:s.bool});const he=k.a.create(e=>({actionsBar:{height:e.spaces.xxLarge,marginTop:0,maxWidth:"none",paddingHorizontal:e.spaces.xSmall},container:{flexDirection:"row",overflowX:"hidden",overflowY:"hidden",height:"100%",width:"100%",position:"relative"},neighbor:{flexGrow:1,flexShrink:1}})),pe=T(le);t.default=pe}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/bundle.TweetMediaDetail.2109ba75.js.map